# 「设置与初始化」模块 UI 设计计划书

> 创建时间：2026-01-07  
> 更新时间：2026-01-07  
> 状态：✅ Phase 1 已完成

---

## 一、概述

将原有的「初始化与重置按钮」区块重构为「设置与初始化」，增加备份设置功能，采用横向简洁的一级/二级列表布局，使用勾选方式进行选项配置。

### 实施范围

| 阶段 | 内容 | 状态 |
|------|------|------|
| **Phase 1** | 书签备份的基础设置（备份模式 + 覆盖策略） | 🟢 本次实施 |
| **Phase 2** | 扩展数据自动备份（备份历史、书签画布等） | 🟡 后续版本 |
| **Phase 3** | 同步与恢复功能 | 🟡 后续版本 |

---

## 二、标题更改

| 原标题 | 新标题 |
|--------|--------|
| 初始化与重置按钮 | 设置与初始化 |
| Initialization & Reset Buttons | Settings & Initialization |

---

## 三、UI 布局设计（Phase 1）

### 整体结构（横向一级/二级列表，紧凑布局）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 🔵 设置与初始化 / Settings & Initialization                            [▼] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 备份设置 / Backup Settings ───────────────────────────────────────────┐│
│  │                                                                         ││
│  │  备份模式 / Backup Mode:                                                ││
│  │    ☑ 全量 Full    ☐ 增量 Incremental                                   ││
│  │                                                                         ││
│  │  增量详情 / Incremental Detail (仅增量模式时启用):                        ││
│  │    ☐ 简略 Simple    ☐ 详情 Detailed                                    ││
│  │  ─────────────────────────────────────────────────────────────────────  ││
│  │  覆盖策略 / Overwrite Policy:                                           ││
│  │    ☑ 版本化 Versioned (带时间戳，多文件)                                 ││
│  │    ☐ 覆盖 Overwrite (单文件，GitHub友好)                                ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
│  ┌─ 同步与恢复 / Sync & Restore (即将推出 / Coming Soon) ─────────────────┐│
│  │                                                                         ││
│  │    ☐ 从云端恢复 / Restore from Cloud     [禁用/Disabled]                ││
│  │    ☐ 冲突处理 / Conflict Resolution      [禁用/Disabled]                ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
│  ┌─ 初始化操作 / Initialization Actions ──────────────────────────────────┐│
│  │                                                                         ││
│  │   ┌─────────────────────────┐    ┌─────────────────────────┐           ││
│  │   │   🔴 恢复到初始状态      │    │   🟢 初始化上传书签      │           ││
│  │   │   Reset to Initial      │    │   Initialize Upload     │           ││
│  │   └─────────────────────────┘    └─────────────────────────┘           ││
│  │        ↓ 点击弹出确认窗              ↓ 保持原有逻辑                      ││
│  │                                                                         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、备份设置详细设计（Phase 1 核心）

### 4.1 备份模式

| 选项 | 中文 | 英文 | 说明 |
|------|------|------|------|
| `full` | 全量 | Full | 整体书签树作为快照保存，每次备份完整记录所有书签数据（当前默认模式） |
| `incremental` | 增量 | Incremental | 仅记录变化差异，类似Git的差异记录 |

**交互逻辑：**
- 默认选中「全量」
- 两个选项互斥（单选）
- 选中「增量」时，下方「增量详情」选项启用

### 4.2 增量详情（仅增量模式时启用）

| 选项 | 中文 | 英文 | 说明 |
|------|------|------|------|
| `simple` | 简略 | Simple | 仅记录变化描述（添加/删除/移动等），参考 history.html 的「简略」视图 |
| `detailed` | 详情 | Detailed | 记录完整变化详情（包含书签树结构），参考 history.html 的「详细」视图 |

**交互逻辑：**
- 默认选中「简略」
- 两个选项互斥（单选）
- 仅当备份模式为「增量」时可选，否则禁用（灰色）

### 4.3 覆盖策略

| 选项 | 中文 | 英文 | 文件命名 | 适用场景 |
|------|------|------|----------|----------|
| `versioned` | 版本化 | Versioned | `bookmark_YYYY-MM-DD_HH_MM_SS.html` | 本地备份、WebDAV（保留历史版本） |
| `overwrite` | 覆盖 | Overwrite | `bookmark_backup.html` | GitHub仓库（单文件覆盖更新） |

**交互逻辑：**
- 默认选中「版本化」
- 两个选项互斥（单选）

---

## 五、各数据类型的覆盖策略（参考）

> 此部分为参考信息，Phase 1 只实现书签备份的设置

| 类型 | 建议覆盖策略 | 原因 | Phase 1 |
|------|-------------|------|---------|
| ① 书签备份 | **用户可选** | 核心功能，需要灵活配置 | ✅ 实现 |
| ② 当前变化 | 版本化 | 每次快照都不同 | ❌ 后续 |
| ③ 备份历史 | 版本化 | 历史记录需要保留 | ❌ 后续 |
| ④ 书签画布 | **覆盖** | 工作区域，只需最新状态 | ❌ 后续 |
| ⑤ 书签添加记录 | 版本化 | 日志性质，需要追溯 | ❌ 后续 |
| ⑥ 点击记录 | 版本化 | 日志性质，需要追溯 | ❌ 后续 |

---

## 六、同步与恢复（预留功能）

> ⚠️ 此功能**暂不实现**，仅预留 UI 位置，显示为禁用状态

### 6.1 从云端恢复 (Coming Soon)

**功能描述：**
- 检测云端是否存在备份数据
- 如有数据，提供「从云端恢复」选项
- 支持选择恢复点（版本化模式下）

### 6.2 冲突处理 (Coming Soon)

**功能描述：**
- 本地与云端数据存在差异时的处理策略
- 可选：保留本地 / 保留云端 / 合并

---

## 七、初始化操作（保持原有逻辑）

### 7.1 恢复到初始状态

- 按钮样式：红色危险按钮
- 点击后弹出现有的确认弹窗 (`resetConfirmDialog`)
- 功能：清除所有配置和备份记录，书签不受影响
- **不做修改**

### 7.2 初始化上传书签

- 按钮样式：绿色主要按钮
- **保持原有逻辑**（点击后执行初始化上传）
- 后续版本可扩展为选择目标弹窗

---

## 八、文件夹结构

### 8.1 原有结构 [原有]

```
书签快照 & 工具箱 导出 / Bookmark Git & Toolbox
├── 书签备份/           [原有] ← 书签自动/手动备份 HTML
├── 当前变化/           [原有] ← 当前变化导出 (HTML/JSON)
├── 备份历史/           [原有] ← 备份历史记录导出 (HTML/JSON/ZIP/MD)
├── 书签画布/           [原有] ← 书签画布导出 (JSON/ZIP)
├── 书签添加记录/        [原有] ← 书签添加记录导出 (HTML/JSON)
└── 点击记录/           [原有] ← 浏览历史导出 (HTML/JSON)
```

### 8.2 新增结构 [新增]

```
书签快照 & 工具箱 导出 / Bookmark Git & Toolbox
├── 书签备份/                    [原有]
│   ├── bookmark_2026-01-07_10_00.html    ← 版本化模式 [原有]
│   └── bookmark_backup.html              ← 覆盖模式 [新增]
│
├── 增量记录/                    [新增] ← 增量备份时的变化记录
│   ├── incremental_2026-01-07.html       ← 版本化模式
│   └── incremental_backup.html           ← 覆盖模式
│
├── 当前变化/                    [原有]
├── 备份历史/                    [原有]
├── 书签画布/                    [原有]
├── 书签添加记录/                 [原有]
└── 点击记录/                    [原有]
```

### 8.3 文件夹名称中英文对照

| 中文 | 英文 | 标记 |
|------|------|------|
| 书签备份 | Bookmark Backup | [原有] |
| 增量记录 | Incremental Log | [新增] |
| 当前变化 | Current Changes | [原有] |
| 备份历史 | Backup History | [原有] |
| 书签画布 | Bookmark Canvas | [原有] |
| 书签添加记录 | Bookmark Additions | [原有] |
| 点击记录 | Click History | [原有] |

---

## 九、存储结构 (Storage Keys)

```javascript
// 新增的设置项存储键
const BACKUP_SETTINGS_KEYS = {
    // 备份模式：'full' | 'incremental'
    BACKUP_MODE: 'backupMode',
    
    // 增量模式详情：'simple' | 'detailed'（仅增量模式时有效）
    INCREMENTAL_DETAIL: 'incrementalDetail',
    
    // 覆盖策略：'versioned' | 'overwrite'  
    OVERWRITE_MODE: 'overwriteMode',
};

// 默认值
const BACKUP_SETTINGS_DEFAULTS = {
    backupMode: 'full',
    incrementalDetail: 'simple',
    overwriteMode: 'versioned',
};
```

---

## 十、中英文 i18n 文案

### 10.1 区块标题

| Key | 中文 | 英文 |
|-----|------|------|
| `settingsInitTitle` | 设置与初始化 | Settings & Initialization |
| `backupSettingsTitle` | 备份设置 | Backup Settings |
| `syncRestoreTitle` | 同步与恢复 | Sync & Restore |
| `syncRestoreComingSoon` | 即将推出 | Coming Soon |
| `initActionsTitle` | 初始化操作 | Initialization Actions |

### 10.2 备份模式

| Key | 中文 | 英文 |
|-----|------|------|
| `backupModeLabel` | 备份模式 | Backup Mode |
| `backupModeFull` | 全量 | Full |
| `backupModeIncremental` | 增量 | Incremental |
| `incrementalDetailLabel` | 增量详情 | Incremental Detail |
| `incrementalSimple` | 简略 | Simple |
| `incrementalDetailed` | 详情 | Detailed |

### 10.3 覆盖策略

| Key | 中文 | 英文 |
|-----|------|------|
| `overwritePolicyLabel` | 覆盖策略 | Overwrite Policy |
| `overwriteVersioned` | 版本化 | Versioned |
| `overwriteVersionedDesc` | 带时间戳，多文件 | With timestamp, multiple files |
| `overwriteOverwrite` | 覆盖 | Overwrite |
| `overwriteOverwriteDesc` | 单文件，GitHub友好 | Single file, GitHub friendly |

### 10.4 同步与恢复

| Key | 中文 | 英文 |
|-----|------|------|
| `restoreFromCloud` | 从云端恢复 | Restore from Cloud |
| `conflictResolution` | 冲突处理 | Conflict Resolution |
| `featureDisabled` | 暂未启用 | Disabled |

### 10.5 初始化操作

| Key | 中文 | 英文 |
|-----|------|------|
| `resetToInitialBtn` | 恢复到初始状态 | Reset to Initial State |
| `initUploadBtn` | 初始化上传书签 | Initialize & Upload Bookmarks |

---

## 十一、实施步骤（Phase 1）

### Step 1: UI 结构修改
- [x] 1.1 修改区块标题「初始化与重置按钮」→「设置与初始化」
- [x] 1.2 添加「备份设置」子区块（勾选框方式）
- [x] 1.3 添加「同步与恢复」子区块（禁用状态预留）
- [x] 1.4 保持「初始化操作」子区块不变

### Step 2: CSS 样式
- [x] 2.1 添加新的样式类（勾选框、分隔线、禁用状态等）- 使用内联样式
- [x] 2.2 确保与现有主题兼容（明/暗模式）- 使用CSS变量

### Step 3: JavaScript 逻辑
- [x] 3.1 添加设置项的读取/保存逻辑
- [x] 3.2 添加勾选交互逻辑（互斥、启用/禁用联动）
- [x] 3.3.1 覆盖策略已实现（WebDAV/GitHub/本地三处均已修改）
- [x] 3.3.2 增量备份模式已实现（生成增量记录HTML并输出到各备份目标）

### Step 4: i18n 国际化
- [x] 4.1 添加中英文文案到 i18n 配置
- [x] 4.2 确保所有新增 UI 元素支持双语切换

---

## 十二、后续版本规划（Phase 2+）

> 以下功能暂不实施，留待后续版本

### Phase 2: 扩展数据自动备份

| 功能 | 说明 |
|------|------|
| 备份历史自动同步 | 版本化策略，定期归档 |
| 书签画布自动同步 | 覆盖策略（工作区域特性） |
| 书签添加记录自动同步 | 版本化策略 |
| 点击记录自动同步 | 版本化策略 |
| 多工作区支持 | 书签画布的多工作区管理 |

### Phase 3: 同步与恢复

| 功能 | 说明 |
|------|------|
| 从云端恢复 | 检测云端备份，选择恢复点 |
| 冲突处理 | 本地与云端差异处理策略 |
| 初始化目标选择 | 上传时选择云端1/云端2/本地 |

---

## 十三、注意事项

1. **兼容性**：确保修改不影响现有功能的正常使用
2. **默认值**：首次使用时应用默认设置（全量 + 版本化）
3. **迁移**：旧用户升级后应保持原有行为（默认全量 + 版本化）
4. **预留位置**：同步与恢复功能仅预留UI，功能后续开发
5. **简化优先**：Phase 1 保持简单，不做过度设计

---

*计划书结束*
