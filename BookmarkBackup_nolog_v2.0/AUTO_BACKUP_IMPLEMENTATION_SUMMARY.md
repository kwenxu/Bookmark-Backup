# å®žæ—¶è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½å®žçŽ°æ€»ç»“

## é¡¹ç›®æ¦‚è¿°
æˆåŠŸä¸ºä¹¦ç­¾å¤‡ä»½æ‰©å±•æ·»åŠ äº†å®Œæ•´çš„å®žæ—¶è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ï¼Œæ”¯æŒä¸‰ç§å¤‡ä»½æ¨¡å¼ï¼Œå¹¶å®Œç¾Žé›†æˆåˆ°çŽ°æœ‰ç³»ç»Ÿä¸­ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. ä¸‰ç§å¤‡ä»½æ¨¡å¼
- **å®žæ—¶è‡ªåŠ¨å¤‡ä»½**: ä¹¦ç­¾å˜åŒ–æ—¶ç«‹å³å¤‡ä»½ï¼ˆéœ€æ»¡è¶³åŒé‡æ¡ä»¶ï¼‰
- **å¾ªçŽ¯è‡ªåŠ¨å¤‡ä»½**: æŒ‰è®¾å®šé—´éš”ï¼ˆå¤©ã€å°æ—¶ã€åˆ†é’Ÿï¼‰å®šæœŸå¤‡ä»½
- **å‡†ç‚¹å®šæ—¶å¤‡ä»½**: åœ¨æ¯å¤©å›ºå®šæ—¶é—´ç‚¹è¿›è¡Œå¤‡ä»½

### 2. æ™ºèƒ½å¤‡ä»½è§¦å‘æ¡ä»¶
- **ä½¿ç”¨æ´»åŠ¨æ£€æµ‹**: é€šè¿‡ `chrome.windows.onFocusChanged` ç›‘å¬æµè§ˆå™¨æ´»è·ƒçŠ¶æ€
- **ä¹¦ç­¾å˜åŒ–æ£€æµ‹**: ç›‘å¬ä¹¦ç­¾çš„æ·»åŠ ã€åˆ é™¤ã€ç§»åŠ¨ã€ä¿®æ”¹æ“ä½œ
- **åŒé‡æ¡ä»¶åˆ¤æ–­**: åªæœ‰åœ¨æœ‰å®žé™…ä½¿ç”¨æ´»åŠ¨ä¸”æœ‰ä¹¦ç­¾å˜åŒ–æ—¶æ‰è§¦å‘å¤‡ä»½

### 3. å®Œæ•´çš„UIç³»ç»Ÿ
- **æ¨¡å¼åˆ‡æ¢ç•Œé¢**: æ ¹æ®ã€Œå®žæ—¶è‡ªåŠ¨å¤‡ä»½ã€å¼€å…³è‡ªåŠ¨åˆ‡æ¢æŒ‰é’®æ˜¾ç¤º
- **è®¾ç½®å¯¹è¯æ¡†**: ä¸‰é€‰é¡¹å¡è®¾è®¡ï¼Œæ”¯æŒå„ç§å‚æ•°é…ç½®
- **è¡¨å•éªŒè¯**: å®Œå–„çš„è¾“å…¥éªŒè¯å’Œé”™è¯¯æç¤º
- **çŠ¶æ€æ˜¾ç¤º**: å®žæ—¶åæ˜ å½“å‰å¤‡ä»½æ¨¡å¼å’ŒçŠ¶æ€

## æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒæ–‡ä»¶ç»“æž„
```
BookmarkBackup_nolog_v2.0/
â”œâ”€â”€ popup.html                     # ä¸»ç•Œé¢ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ popup.js                       # UIé€»è¾‘ï¼ˆå·²æ‰©å±•ï¼‰
â”œâ”€â”€ background.js                   # åŽå°è„šæœ¬ï¼ˆå·²æ‰©å±•ï¼‰
â”œâ”€â”€ backup_reminder/
â”‚   â”œâ”€â”€ auto_backup_timer.js       # è‡ªåŠ¨å¤‡ä»½æ ¸å¿ƒæ¨¡å—ï¼ˆæ–°å¢žï¼‰
â”‚   â””â”€â”€ ...                        # å…¶ä»–çŽ°æœ‰æ–‡ä»¶
â”œâ”€â”€ AUTO_BACKUP_TEST_PLAN.md       # æµ‹è¯•è®¡åˆ’ï¼ˆæ–°å¢žï¼‰
â””â”€â”€ AUTO_BACKUP_IMPLEMENTATION_SUMMARY.md  # å®žçŽ°æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### å…³é”®æŠ€æœ¯ç»„ä»¶

#### 1. auto_backup_timer.js - æ ¸å¿ƒæ¨¡å—
- **å®šæ—¶å™¨ç®¡ç†**: æ”¯æŒå¾ªçŽ¯å’Œå‡†ç‚¹å®šæ—¶çš„Chrome alarms API
- **çŠ¶æ€è·Ÿè¸ª**: ç®¡ç†ä½¿ç”¨æ´»åŠ¨ã€ä¹¦ç­¾å˜åŒ–ã€å¤‡ä»½é…ç½®ç­‰çŠ¶æ€
- **å¤‡ä»½æ‰§è¡Œ**: æ•´åˆWebDAVå’Œæœ¬åœ°å¤‡ä»½ï¼Œè®°å½•å¤‡ä»½ç»“æžœ
- **é…ç½®ç®¡ç†**: è®¾ç½®çš„éªŒè¯ã€ä¿å­˜ã€æ¢å¤ç­‰åŠŸèƒ½

#### 2. popup.js - UIäº¤äº’å¢žå¼º  
- **ç•Œé¢åˆ‡æ¢é€»è¾‘**: æ ¹æ®æ¨¡å¼è‡ªåŠ¨æ˜¾ç¤º/éšè—ç›¸åº”æŒ‰é’®
- **å¯¹è¯æ¡†ç®¡ç†**: å®Œæ•´çš„è®¾ç½®å¯¹è¯æ¡†ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **è¡¨å•éªŒè¯**: å®¢æˆ·ç«¯è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
- **çŠ¶æ€åŒæ­¥**: ä¸ŽåŽå°è„šæœ¬çš„åŒå‘æ•°æ®åŒæ­¥

#### 3. background.js - åŽå°æœåŠ¡æ‰©å±•
- **æ¶ˆæ¯å¤„ç†**: æ–°å¢žå¤šä¸ªè‡ªåŠ¨å¤‡ä»½ç›¸å…³çš„æ¶ˆæ¯å¤„ç†å™¨
- **ç³»ç»Ÿåˆå§‹åŒ–**: æ‰©å±•å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–å¤‡ä»½ç³»ç»Ÿ
- **çŠ¶æ€é›†æˆ**: ä¸ŽçŽ°æœ‰å¤‡ä»½è®°å½•å’Œè§’æ ‡ç³»ç»Ÿæ— ç¼é›†æˆ

### æ•°æ®æµæž¶æž„

```
ç”¨æˆ·ç•Œé¢ (popup.js)
       â†• (chrome.runtime.sendMessage)
åŽå°è„šæœ¬ (background.js)
       â†• (åŠ¨æ€å¯¼å…¥ + å‡½æ•°è°ƒç”¨)
è‡ªåŠ¨å¤‡ä»½æ¨¡å— (auto_backup_timer.js)
       â†•
Chrome APIs (alarms, storage, bookmarks, windows)
```

## æ ¸å¿ƒç®—æ³•

### 1. æ—¶é—´è½¬æ¢ç®—æ³•
```javascript
function convertTimeToMilliseconds(days = 0, hours = 0, minutes = 0) {
    return (days * 24 * 60 * 60 * 1000) + 
           (hours * 60 * 60 * 1000) + 
           (minutes * 60 * 1000);
}
```

### 2. å‡†ç‚¹å®šæ—¶è®¡ç®—
```javascript
function calculateNextScheduledTime(timeStr, forceNextDay = false) {
    const [hours, minutes] = timeStr.split(':').map(num => parseInt(num, 10));
    const now = new Date();
    const targetTime = new Date();
    targetTime.setHours(hours, minutes, 0, 0);
    
    if (forceNextDay || targetTime <= now) {
        targetTime.setDate(targetTime.getDate() + 1);
    }
    
    return targetTime.getTime();
}
```

### 3. åŒé‡æ¡ä»¶æ£€æµ‹
```javascript
async function shouldTriggerBackup() {
    const hasActivity = hasUsageActivity();           // æµè§ˆå™¨æ´»è·ƒ
    const hasChanges = await hasBookmarkChanges();   // ä¹¦ç­¾å˜åŒ–
    return hasActivity && hasChanges;
}
```

## æ•°æ®å­˜å‚¨è®¾è®¡

### Chrome Storage Local æ–°å¢žå­—æ®µ
```javascript
{
    // è‡ªåŠ¨å¤‡ä»½æ¨¡å¼é…ç½®
    autoBackupMode: 'realtime' | 'cyclic' | 'scheduled',
    
    // å¾ªçŽ¯å¤‡ä»½è®¾ç½®
    cyclicAutoBackupSettings: {
        enabled: boolean,
        days: number,    // 0-30
        hours: number,   // 0-24  
        minutes: number  // 0-60
    },
    
    // å‡†ç‚¹å®šæ—¶è®¾ç½®
    scheduledAutoBackupSettings: {
        time1: { enabled: boolean, time: 'HH:MM' },
        time2: { enabled: boolean, time: 'HH:MM' }
    }
}
```

## é›†æˆç‚¹è®¾è®¡

### 1. ä¸ŽçŽ°æœ‰UIçš„é›†æˆ
- å¤ç”¨çŽ°æœ‰çš„å¼€å…³æ ·å¼å’Œäº¤äº’é€»è¾‘
- ä¿æŒä¸€è‡´çš„è§†è§‰è®¾è®¡è¯­è¨€
- æ— ç¼çš„æ¨¡å¼åˆ‡æ¢ä½“éªŒ

### 2. ä¸Žå¤‡ä»½ç³»ç»Ÿçš„é›†æˆ  
- å¤ç”¨çŽ°æœ‰çš„WebDAVå’Œæœ¬åœ°å¤‡ä»½é€»è¾‘
- ç»§æ‰¿å¤‡ä»½è®°å½•å’ŒåŽ†å²ç®¡ç†
- ä¿æŒå¤‡ä»½æ ¼å¼å’Œæ–‡ä»¶å‘½åçš„ä¸€è‡´æ€§

### 3. ä¸ŽçŠ¶æ€ç®¡ç†çš„é›†æˆ
- é›†æˆåˆ°çŽ°æœ‰çš„è§’æ ‡ç³»ç»Ÿ
- å¤ç”¨ä¹¦ç­¾å˜åŒ–æ£€æµ‹æœºåˆ¶
- ä¿æŒçŠ¶æ€æ˜¾ç¤ºçš„ä¸€è‡´æ€§

## æ€§èƒ½ä¼˜åŒ–

### 1. èµ„æºç®¡ç†
- åŠ¨æ€æ¨¡å—å¯¼å…¥å‡å°‘åˆå§‹åŠ è½½æ—¶é—´
- å®šæ—¶å™¨çš„æ­£ç¡®æ¸…ç†é¿å…å†…å­˜æ³„æ¼
- äº‹ä»¶ç›‘å¬å™¨çš„åˆç†ç®¡ç†

### 2. æ‰¹é‡æ“ä½œ
- çŸ­æ—¶é—´å†…çš„å¤šæ¬¡ä¹¦ç­¾å˜åŒ–åˆå¹¶å¤„ç†
- é¿å…é¢‘ç¹çš„å¤‡ä»½æ“ä½œ
- æ™ºèƒ½çš„é‡å¤æ£€æµ‹

### 3. é”™è¯¯æ¢å¤
- å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- ç½‘ç»œé”™è¯¯çš„é‡è¯•é€»è¾‘
- é…ç½®æŸåçš„æ¢å¤æœºåˆ¶

## éªŒè¯å’Œæµ‹è¯•

### å·²å®Œæˆçš„éªŒè¯
- âœ… è¯­æ³•æ£€æŸ¥: æ‰€æœ‰JavaScriptæ–‡ä»¶é€šè¿‡Node.jsè¯­æ³•éªŒè¯
- âœ… æ¨¡å—å¯¼å…¥: ç¡®è®¤æ¨¡å—å¯¼å…¥è·¯å¾„æ­£ç¡®
- âœ… APIå…¼å®¹: éªŒè¯Chrome Extension APIsçš„æ­£ç¡®ä½¿ç”¨
- âœ… æ•°æ®æµ: ç¡®è®¤ç»„ä»¶é—´çš„æ¶ˆæ¯ä¼ é€’æ­£ç¡®

### å¾…è¿›è¡Œçš„æµ‹è¯•
- ðŸ”„ åŠŸèƒ½æµ‹è¯•: æŒ‰ç…§æµ‹è¯•è®¡åˆ’è¿›è¡Œå®Œæ•´åŠŸèƒ½éªŒè¯
- ðŸ”„ é›†æˆæµ‹è¯•: éªŒè¯ä¸ŽçŽ°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§  
- ðŸ”„ æ€§èƒ½æµ‹è¯•: é•¿æœŸè¿è¡Œå’Œèµ„æºä½¿ç”¨ç›‘æŽ§
- ðŸ”„ ç”¨æˆ·æµ‹è¯•: å®žé™…ä½¿ç”¨åœºæ™¯çš„ç”¨æˆ·ä½“éªŒæµ‹è¯•

## æ‰©å±•æ€§è®¾è®¡

### 1. æ¨¡å—åŒ–æž¶æž„
- æ ¸å¿ƒåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—ï¼Œæ˜“äºŽç»´æŠ¤å’Œæ‰©å±•
- æ¸…æ™°çš„æŽ¥å£è®¾è®¡ï¼Œæ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•
- é…ç½®é©±åŠ¨çš„è®¾è®¡ï¼Œä¾¿äºŽæ·»åŠ æ–°çš„å¤‡ä»½æ¨¡å¼

### 2. å¯é…ç½®æ€§
- æ‰€æœ‰å…³é”®å‚æ•°éƒ½å¯é€šè¿‡UIé…ç½®
- æ”¯æŒå¯¼å…¥/å¯¼å‡ºé…ç½®
- é¢„è®¾é…ç½®çš„ç®¡ç†

### 3. å›½é™…åŒ–æ”¯æŒ
- UIæ–‡æœ¬çš„å¤šè¯­è¨€æ”¯æŒå‡†å¤‡
- æ—¶é—´æ ¼å¼çš„æœ¬åœ°åŒ–
- é”™è¯¯ä¿¡æ¯çš„æœ¬åœ°åŒ–

## æœ€ä½³å®žè·µåº”ç”¨

### 1. Chrome Extensionå¼€å‘
- æ­£ç¡®ä½¿ç”¨Manifest V3çš„ç‰¹æ€§
- Service Workerçš„åˆç†ä½¿ç”¨
- æƒé™çš„æœ€å°åŒ–åŽŸåˆ™

### 2. ç”¨æˆ·ä½“éªŒè®¾è®¡
- æ¸è¿›å¼åŠŸèƒ½æš´éœ²
- æ˜Žç¡®çš„çŠ¶æ€åé¦ˆ
- å®¹é”™æ€§è®¾è®¡

### 3. ä»£ç è´¨é‡
- ä¸€è‡´çš„ç¼–ç é£Žæ ¼
- å……åˆ†çš„é”™è¯¯å¤„ç†
- æ¸…æ™°çš„æ–‡æ¡£å’Œæ³¨é‡Š

## æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2ä¸ªæœˆï¼‰
1. **å¢žå¼ºé”™è¯¯å¤„ç†**: æ›´è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œç”¨æˆ·å‹å¥½çš„æç¤º
2. **æ€§èƒ½ç›‘æŽ§**: æ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†å’Œåˆ†æž
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·ä½¿ç”¨æ•°æ®å’Œæ”¹è¿›å»ºè®®

### ä¸­æœŸå‘å±•ï¼ˆ3-6ä¸ªæœˆï¼‰  
1. **æ™ºèƒ½å¤‡ä»½**: åŸºäºŽä½¿ç”¨æ¨¡å¼çš„æ™ºèƒ½å¤‡ä»½æŽ¨è
2. **å¤šè®¾å¤‡åŒæ­¥**: è·¨è®¾å¤‡çš„é…ç½®å’ŒçŠ¶æ€åŒæ­¥
3. **å¤‡ä»½ç­–ç•¥**: å¢žé‡å¤‡ä»½ã€åŽ‹ç¼©å¤‡ä»½ç­‰é«˜çº§ç­–ç•¥

### é•¿æœŸè§„åˆ’ï¼ˆ6ä¸ªæœˆä»¥ä¸Šï¼‰
1. **AIé›†æˆ**: æ™ºèƒ½çš„å¤‡ä»½æ—¶é—´é¢„æµ‹å’Œä¼˜åŒ–
2. **äº‘æœåŠ¡æ‰©å±•**: æ”¯æŒæ›´å¤šçš„äº‘å­˜å‚¨æœåŠ¡
3. **ä¼ä¸šåŠŸèƒ½**: é›†ä¸­ç®¡ç†ã€ç­–ç•¥æŽ§åˆ¶ç­‰ä¼ä¸šçº§åŠŸèƒ½

## æ€»ç»“

å®žæ—¶è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½çš„æˆåŠŸå®žçŽ°æ ‡å¿—ç€ä¹¦ç­¾å¤‡ä»½æ‰©å±•åŠŸèƒ½çš„é‡å¤§å‡çº§ã€‚é€šè¿‡ä¸‰ç§çµæ´»çš„å¤‡ä»½æ¨¡å¼ã€æ™ºèƒ½çš„è§¦å‘æ¡ä»¶å’Œå®Œå–„çš„UIé›†æˆï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´åŠ è‡ªåŠ¨åŒ–å’Œå¯é çš„ä¹¦ç­¾ä¿æŠ¤è§£å†³æ–¹æ¡ˆã€‚

### æŠ€æœ¯æˆå°±
- âœ… å®Œæ•´çš„è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿæž¶æž„
- âœ… ä¸‰ç§å¤‡ä»½æ¨¡å¼çš„æ— ç¼é›†æˆ  
- âœ… æ™ºèƒ½çš„åŒé‡æ¡ä»¶æ£€æµ‹æœºåˆ¶
- âœ… å®Œå–„çš„UIå’Œç”¨æˆ·ä½“éªŒè®¾è®¡
- âœ… ä¸ŽçŽ°æœ‰ç³»ç»Ÿçš„æ·±åº¦é›†æˆ

### ä¸šåŠ¡ä»·å€¼
- ðŸ’¡ å¤§å¹…æå‡ç”¨æˆ·ä½“éªŒå’Œä¾¿åˆ©æ€§
- ðŸ’¡ é™ä½Žç”¨æˆ·æ•°æ®ä¸¢å¤±çš„é£Žé™©
- ðŸ’¡ å¢žå¼ºäº§å“ç«žäº‰åŠ›å’Œç”¨æˆ·ç²˜æ€§
- ðŸ’¡ ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€

è¿™ä¸ªåŠŸèƒ½çš„æˆåŠŸå®žçŽ°å±•ç¤ºäº†åœ¨çŽ°æœ‰å¤æ‚ç³»ç»ŸåŸºç¡€ä¸Šè¿›è¡Œå¤§åž‹åŠŸèƒ½æ‰©å±•çš„å¯è¡Œæ€§ï¼Œå¹¶ä¸ºåŽç»­çš„äº§å“è¿­ä»£æä¾›äº†è‰¯å¥½çš„æŠ€æœ¯åŸºç¡€ã€‚