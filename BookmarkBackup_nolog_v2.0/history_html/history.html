<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="bookmark_tree_context_menu.js" defer></script>
    <script src="bookmark_tree_drag_drop.js" defer></script>
    <script src="history.js" defer></script>
</head>
<body>
    <!-- 头部导航 -->
    <header class="history-header">
        <div class="header-left">
            <h1 id="pageTitle">备份历史查看器</h1>
            <span class="header-subtitle" id="pageSubtitle">类似 Git 的书签变化追踪</span>
        </div>
        <div class="header-right">
            <!-- 搜索框 -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="搜索书签、文件夹..." />
                <i class="fas fa-search"></i>
            </div>
            
            <!-- 工具按钮组 -->
            <div class="tool-buttons">
                <button id="refreshBtn" class="tool-btn">
                    <i class="fas fa-sync-alt"></i>
                    <span class="btn-tooltip" id="refreshTooltip"></span>
                </button>
                <!-- 主题切换按钮 - 独立设置，主UI优先 -->
                <button id="themeToggle" class="tool-btn">
                    <i class="fas fa-moon"></i>
                    <span class="btn-tooltip" id="themeTooltip"></span>
                </button>
                <!-- 语言切换按钮 - 独立设置，主UI优先 -->
                <button id="langToggle" class="tool-btn">
                    <span class="lang-text">EN</span>
                    <span class="btn-tooltip" id="langTooltip"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <div class="main-container">
        <!-- 左侧导航栏 -->
        <aside class="sidebar">
            <nav class="nav-tabs">
                <button class="nav-tab active" data-view="current-changes">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="navCurrentChangesText">当前 数量/结构 变化</span>
                </button>
                <button class="nav-tab" data-view="tree">
                    <i class="fas fa-sitemap"></i>
                    <span id="navTreeText">书签树</span>
                </button>
                <button class="nav-tab" data-view="history">
                    <i class="fas fa-history"></i>
                    <span id="navHistoryText">备份历史</span>
                </button>
                <button class="nav-tab" data-view="additions">
                    <i class="fas fa-plus-circle"></i>
                    <span id="navAdditionsText">书签添加记录</span>
                </button>
            </nav>

            <!-- 统计信息 -->
            <div class="stats-panel">
                <h3 id="statsTitle">统计信息</h3>
                <div class="stat-item">
                    <span id="statBackupsLabel">总备份次数</span>
                    <strong id="statBackupsCount">0</strong>
                </div>
                <div class="stat-item">
                    <span id="statBookmarksLabel">当前书签</span>
                    <strong id="statBookmarksCount">0</strong>
                </div>
                <div class="stat-item">
                    <span id="statFoldersLabel">当前文件夹</span>
                    <strong id="statFoldersCount">0</strong>
                </div>
            </div>
        </aside>

        <!-- 右侧内容区域 -->
        <main class="content-area">
            <!-- 当前变化视图 -->
            <div id="current-changesView" class="view active">
                <div class="view-header">
                    <h2 id="currentChangesViewTitle">当前 数量/结构 变化</h2>
                    <p class="view-description" id="currentChangesViewDesc">查看未备份的书签变化详情</p>
                    <div class="view-header-right">
                        <button id="revertAllCurrentBtn" class="view-action-btn">
                            <i class="fas fa-undo"></i>
                            <span id="revertAllCurrentText">全部撤销</span>
                        </button>
                    </div>
                </div>
                <div id="currentChangesList" class="current-changes-container">
                    <!-- 动态加载当前变化 -->
                </div>
            </div>

            <!-- 备份历史视图 -->
            <div id="historyView" class="view">
                <div class="view-header">
                    <div class="view-header-left">
                        <h2 id="historyViewTitle">备份历史记录</h2>
                        <p class="view-description" id="historyViewDesc">查看所有备份记录及其详细变化</p>
                    </div>
                    <div class="view-header-right">
                        <button id="copyAllHistoryBtn" class="view-action-btn" onclick="window.copyAllHistoryDiff()">
                            <i class="fas fa-copy"></i> 
                            <span id="copyAllHistoryText">复制所有记录</span>
                        </button>
                    </div>
                </div>
                <div id="historyList" class="history-commits">
                    <!-- 动态加载历史记录 -->
                </div>
            </div>

            <!-- 书签添加记录视图 -->
            <div id="additionsView" class="view">
                <div class="view-header">
                    <h2 id="additionsViewTitle">书签添加记录</h2>
                    <p class="view-description" id="additionsViewDesc">按时间和文件夹分类查看新增书签</p>
                </div>
                
                <!-- 过滤器 -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <label class="filter-label" id="filterStatusLabel">状态</label>
                        <button class="filter-btn active" data-filter="all" id="filterAll">全部</button>
                        <button class="filter-btn" data-filter="backed-up" id="filterBackedUp">已备份</button>
                        <button class="filter-btn" data-filter="not-backed-up" id="filterNotBackedUp">未备份</button>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" id="filterTimeLabel">时间</label>
                        <button class="time-filter-btn active" data-time-filter="all" id="timeFilterAll">全部</button>
                        <button class="time-filter-btn" data-time-filter="year" id="timeFilterYear">按年</button>
                        <button class="time-filter-btn" data-time-filter="month" id="timeFilterMonth">按月</button>
                        <button class="time-filter-btn" data-time-filter="day" id="timeFilterDay">按日</button>
                    </div>
                </div>

                <div id="additionsList" class="additions-container">
                    <!-- 动态加载书签添加记录 -->
                </div>
            </div>

            <!-- 书签树视图 -->
            <div id="treeView" class="view">
                <div class="view-header">
                    <div class="view-header-left">
                        <h2 id="treeViewTitle">书签树</h2>
                        <p class="view-description" id="treeViewDesc">查看完整的书签结构及变动状态</p>
                    </div>
                    <div class="view-header-right">
                        <button id="revertAllTreeBtn" class="view-action-btn">
                            <i class="fas fa-undo"></i>
                            <span id="revertAllTreeText">全部撤销</span>
                        </button>
                    </div>
                </div>
                <div id="bookmarkTree" class="bookmark-tree">
                    <!-- 动态加载书签树 -->
                </div>
            </div>
        </main>
    </div>

    <!-- 详情弹窗 -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">变化详情</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 动态加载详情内容 -->
            </div>
        </div>
    </div>
</body>
</html>
