<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="history.css">
    <link rel="stylesheet" href="canvas_obsidian_style.css">
    <link rel="stylesheet" href="bookmark_calendar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="history_bootstrap.js" defer></script>
    <script src="vendor/marked.min.js"></script>
    <script src="vendor/obsidian-markdown.js"></script>
    <script src="bookmark_tree_context_menu.js" defer></script>
    <script src="bookmark_tree_drag_drop.js" defer></script>
    <script src="pointer_drag.js" defer></script>
    <script src="bookmark_canvas_module.js" defer></script>
    <script src="shortcuts_helpers.js" defer></script>
    <script src="bookmark_calendar.js" defer></script>
    <script src="browsing_history_calendar.js" defer></script>
    <!-- 新增：浏览历史数据库架构 -->
    <script src="database/utils.js" defer></script>
    <script src="database/AllHistoryDatabase.js" defer></script>
    <script src="database/BookmarkDatabase.js" defer></script>
    <script src="database/BookmarkHistoryDatabase.js" defer></script>
    <script src="database/DatabaseManager.js" defer></script>
    <script src="history.js" defer></script>
</head>
<body>
    <!-- 头部导航 -->
    <header class="history-header">
        <div class="header-left">
            <h1 id="pageTitle">备份历史查看器</h1>
            <span class="header-subtitle" id="pageSubtitle">类似 Git 的书签变化追踪</span>
        </div>
        <div class="header-right">
            <!-- 搜索框 -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="搜索书签、文件夹..." />
                <i class="fas fa-search"></i>
            </div>
            
            <!-- 工具按钮组 -->
            <div class="tool-buttons">
                <button id="refreshBtn" class="tool-btn">
                    <i class="fas fa-sync-alt"></i>
                    <span class="btn-tooltip" id="refreshTooltip"></span>
                </button>
                <!-- 主题切换按钮 - 独立设置，主UI优先 -->
                <button id="themeToggle" class="tool-btn">
                    <i class="fas fa-moon"></i>
                    <span class="btn-tooltip" id="themeTooltip"></span>
                </button>
                <!-- 语言切换按钮 - 独立设置，主UI优先 -->
                <button id="langToggle" class="tool-btn">
                    <span class="lang-text">EN</span>
                    <span class="btn-tooltip" id="langTooltip"></span>
                </button>
                <!-- 说明按钮：快捷键 & 开源信息 -->
                <button id="helpToggle" class="tool-btn">
                    <i class="fas fa-question-circle"></i>
                    <span class="btn-tooltip" id="helpTooltip"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <div class="main-container">
        <!-- 左侧导航栏 -->
        <aside class="sidebar" id="sidebar">
            <!-- 侧边栏收起按钮 -->
            <button class="sidebar-toggle" id="sidebarToggle" title="收起/展开侧边栏">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <nav class="nav-tabs">
                <!-- Bookmark Git 区域组 -->
                <div class="nav-group">
                    <div class="nav-group-title" id="bookmarkGitTitle"></div>
                    <button class="nav-tab" data-view="current-changes">
                        <i class="fas fa-exchange-alt"></i>
                        <span id="navCurrentChangesText">当前 数量/结构 变化</span>
                    </button>
                    <button class="nav-tab" data-view="history">
                        <i class="fas fa-history"></i>
                        <span id="navHistoryText">备份历史</span>
                    </button>
                </div>

                <!-- Bookmark toolbox 区域组 -->
                <div class="nav-group">
                    <div class="nav-group-title" id="bookmarkToolboxTitle"></div>
                    <button class="nav-tab" data-view="canvas">
                        <i class="fas fa-project-diagram"></i>
                        <span id="navCanvasText">Bookmark Canvas</span>
                    </button>
                    <button class="nav-tab" data-view="additions">
                        <i class="fas fa-plus-circle"></i>
                        <span id="navAdditionsText">书签温故</span>
                    </button>
                </div>
            </nav>

            <!-- 统计信息 -->
            <div class="stats-panel">
                <h3 id="statsTitle">统计信息</h3>
                <div class="stat-item">
                    <span id="statBackupsLabel">总备份次数</span>
                    <strong id="statBackupsCount">0</strong>
                </div>
                <div class="stat-item">
                    <span id="statBookmarksLabel">当前书签</span>
                    <strong id="statBookmarksCount">0</strong>
                </div>
                <div class="stat-item">
                    <span id="statFoldersLabel">当前文件夹</span>
                    <strong id="statFoldersCount">0</strong>
                </div>
            </div>
        </aside>

        <!-- 右侧内容区域 -->
        <main class="content-area">
            <!-- 快捷键与开源信息弹窗 -->
            <div id="shortcutsModal" class="modal">
                <div class="modal-content shortcuts-modal">
                    <div class="shortcuts-header">
                        <h2 id="shortcutsModalTitle"></h2>
                        <button id="closeShortcutsModal" class="modal-close" aria-label="Close">×</button>
                    </div>
                    <div id="openSourceInfo" class="shortcuts-section open-source-section">
                        <div class="shortcuts-card">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div>
                                    <p id="openSourceGithubLabel" style="font-size: 14px; color: var(--text-secondary); margin: 0 0 4px 0;">GitHub 仓库:</p>
                                    <a id="openSourceGithubLink" href="https://github.com/kwenxu/Bookmark-Backup?tab=readme-ov-file#readme" target="_blank" style="display: block; padding: 8px 12px; background-color: var(--bg-tertiary); border-radius: 6px; color: var(--link-color); text-decoration: none; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        <i class="fab fa-github" style="margin-right: 5px;"></i>
                                        https://github.com/kwenxu/Bookmark-Backup
                                    </a>
                                </div>
                                
                                <div>
                                    <p id="openSourceIssueLabel" style="font-size: 14px; color: var(--text-secondary); margin: 0 0 4px 0;">问题反馈:</p>
                                    <a id="openSourceIssueLink" href="https://github.com/kwenxu/Bookmark-Backup/issues" target="_blank" style="display: block; padding: 8px 12px; background-color: var(--bg-tertiary); border-radius: 6px; color: var(--link-color); text-decoration: none;">
                                        <i class="fas fa-exclamation-circle" style="margin-right: 5px;"></i>
                                        <span id="openSourceIssueText">提交问题</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="shortcuts-divider" />
                    <div id="shortcutsContent" class="shortcuts-section"></div>
                </div>
            </div>

            <!-- 当前变化视图 -->
            <div id="current-changesView" class="view">
                <div class="view-header">
                    <h2 id="currentChangesViewTitle">当前 数量/结构 变化</h2>
                    <div class="view-header-right">
                        <button id="revertAllCurrentBtn" class="view-action-btn">
                            <i class="fas fa-undo"></i>
                            <span id="revertAllCurrentText">全部撤销</span>
                        </button>
                    </div>
                </div>
                <div id="currentChangesList" class="current-changes-container">
                    <!-- 动态加载当前变化 -->
                </div>
            </div>

            <!-- 备份历史视图 -->
            <div id="historyView" class="view">
                <div class="view-header">
                    <div class="view-header-left">
                        <h2 id="historyViewTitle">备份历史记录</h2>
                    </div>
                    <div class="view-header-right">
                        <button id="copyAllHistoryBtn" class="view-action-btn" data-action="copyAllHistory">
                            <i class="fas fa-copy"></i>
                            <span id="copyAllHistoryText">复制所有记录</span>
                        </button>
                    </div>
                </div>
                <div id="historyList" class="history-commits">
                    <!-- 动态加载历史记录 -->
                </div>
            </div>

            <!-- 书签记录视图 -->
            <div id="additionsView" class="view">
                <div class="view-header">
                    <h2 id="additionsViewTitle">书签记录</h2>
                </div>
                
                <!-- 书签记录子视图标签 -->
                <div class="additions-tabs">
                    <button id="additionsTabReview" class="additions-tab active" data-tab="review">书签添加记录</button>
                    <button id="additionsTabBrowsing" class="additions-tab" data-tab="browsing">书签浏览记录</button>
                    <button id="additionsTabAnki" class="additions-tab" data-tab="anki">书签Anki</button>
                </div>

                <!-- 子视图 1：书签添加记录（日历视图） -->
                <div id="additionsReviewPanel" class="additions-subview active">
                    <!-- 面包屑导航 -->
                    <div class="calendar-breadcrumb-nav">
                        <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                            <div class="breadcrumb-item-wrapper">
                                <button class="breadcrumb-btn active" id="breadcrumbYear">
                                    <i class="fas fa-calendar"></i>
                                    <span id="breadcrumbYearText">2024年</span>
                                </button>
                                <div class="breadcrumb-dropdown-trigger" data-target="breadcrumbYear">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="breadcrumb-dropdown-menu" id="breadcrumbYear-menu">
                                    <!-- 年份候选项将在这里动态生成 -->
                                </div>
                            </div>
                            <span class="breadcrumb-separator" id="separator1" style="display:none;">/</span>
                            <div class="breadcrumb-item-wrapper">
                                <button class="breadcrumb-btn" id="breadcrumbMonth" style="display:none;">
                                    <span id="breadcrumbMonthText">11月</span>
                                </button>
                                <div class="breadcrumb-dropdown-trigger" data-target="breadcrumbMonth">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="breadcrumb-dropdown-menu" id="breadcrumbMonth-menu">
                                    <!-- 月份候选项将在这里动态生成 -->
                                </div>
                            </div>
                            <span class="breadcrumb-separator" id="separator2" style="display:none;">/</span>
                            <div class="breadcrumb-item-wrapper">
                                <button class="breadcrumb-btn" id="breadcrumbWeek" style="display:none;">
                                    <span id="breadcrumbWeekText">第45周</span>
                                </button>
                                <div class="breadcrumb-dropdown-trigger" data-target="breadcrumbWeek">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="breadcrumb-dropdown-menu" id="breadcrumbWeek-menu">
                                    <!-- 周候选项将在这里动态生成 -->
                                </div>
                            </div>
                            <span class="breadcrumb-separator" id="separator3" style="display:none;">/</span>
                            <div class="breadcrumb-item-wrapper">
                                <button class="breadcrumb-btn" id="breadcrumbDay" style="display:none;">
                                    <span id="breadcrumbDayText">11月20日</span>
                                </button>
                                <div class="breadcrumb-dropdown-trigger" data-target="breadcrumbDay">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="breadcrumb-dropdown-menu" id="breadcrumbDay-menu">
                                    <!-- 日期候选项将在这里动态生成 -->
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button class="calendar-action-btn" id="calendarExportBtn">
                                <i class="fas fa-file-export"></i>
                                <span class="btn-tooltip" id="calendarExportTooltip">导出记录</span>
                            </button>
                            <button class="calendar-action-btn" id="calendarSelectModeBtn">
                                <i class="fas fa-check-square"></i>
                                <span class="btn-tooltip" id="calendarSelectModeText">勾选</span>
                            </button>
                            <button class="calendar-action-btn" id="calendarLocateTodayBtn">
                                <i class="fas fa-crosshairs"></i>
                                <span class="btn-tooltip" id="calendarLocateTodayText">定位至今天</span>
                            </button>
                        </div>
                    </div>

                    <!-- 日历容器 -->
                    <div id="bookmarkCalendarView" class="bookmark-calendar-view">
                        <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-calendar-alt" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
                            <p id="calendarLoadingText">正在加载日历...</p>
                        </div>
                    </div>
                </div>

                <!-- 子视图 2：书签浏览记录 -->
                <div id="additionsBrowsingPanel" class="additions-subview">
                    <!-- 浏览记录子视图标签 -->
                    <div class="browsing-sub-tabs">
                        <button id="browsingTabHistory" class="browsing-sub-tab active" data-sub-tab="history">点击记录</button>
                        <button id="browsingTabRanking" class="browsing-sub-tab" data-sub-tab="ranking">点击排行</button>
                        <button id="browsingTabRelated" class="browsing-sub-tab" data-sub-tab="related">书签关联记录</button>
                    </div>

                    <!-- 子视图 2.1：点击记录（日历视图） -->
                    <div id="browsingHistoryPanel" class="browsing-sub-panel active">
                        <!-- 面包屑导航 -->
                        <div class="calendar-breadcrumb-nav">
                            <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                <div class="breadcrumb-item-wrapper">
                                    <button class="breadcrumb-btn active" id="browsingBreadcrumbYear">
                                        <i class="fas fa-calendar"></i>
                                        <span id="browsingBreadcrumbYearText">2024年</span>
                                    </button>
                                    <div class="breadcrumb-dropdown-trigger" data-target="browsingBreadcrumbYear">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="breadcrumb-dropdown-menu" id="browsingBreadcrumbYear-menu">
                                        <!-- 年份候选项将在这里动态生成 -->
                                    </div>
                                </div>
                                <span class="breadcrumb-separator" id="browsingSeparator1" style="display:none;">/</span>
                                <div class="breadcrumb-item-wrapper">
                                    <button class="breadcrumb-btn" id="browsingBreadcrumbMonth" style="display:none;">
                                        <span id="browsingBreadcrumbMonthText">11月</span>
                                    </button>
                                    <div class="breadcrumb-dropdown-trigger" data-target="browsingBreadcrumbMonth">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="breadcrumb-dropdown-menu" id="browsingBreadcrumbMonth-menu">
                                        <!-- 月份候选项将在这里动态生成 -->
                                    </div>
                                </div>
                                <span class="breadcrumb-separator" id="browsingSeparator2" style="display:none;">/</span>
                                <div class="breadcrumb-item-wrapper">
                                    <button class="breadcrumb-btn" id="browsingBreadcrumbWeek" style="display:none;">
                                        <span id="browsingBreadcrumbWeekText">第45周</span>
                                    </button>
                                    <div class="breadcrumb-dropdown-trigger" data-target="browsingBreadcrumbWeek">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="breadcrumb-dropdown-menu" id="browsingBreadcrumbWeek-menu">
                                        <!-- 周候选项将在这里动态生成 -->
                                    </div>
                                </div>
                                <span class="breadcrumb-separator" id="browsingSeparator3" style="display:none;">/</span>
                                <div class="breadcrumb-item-wrapper">
                                    <button class="breadcrumb-btn" id="browsingBreadcrumbDay" style="display:none;">
                                        <span id="browsingBreadcrumbDayText">11月20日</span>
                                    </button>
                                    <div class="breadcrumb-dropdown-trigger" data-target="browsingBreadcrumbDay">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="breadcrumb-dropdown-menu" id="browsingBreadcrumbDay-menu">
                                        <!-- 日期候选项将在这里动态生成 -->
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="calendar-action-btn" id="browsingCalendarExportBtn">
                                    <i class="fas fa-file-export"></i>
                                    <span class="btn-tooltip" id="browsingCalendarExportTooltip">导出记录</span>
                                </button>
                                <button class="calendar-action-btn" id="browsingCalendarSelectModeBtn">
                                    <i class="fas fa-check-square"></i>
                                    <span class="btn-tooltip" id="browsingCalendarSelectModeText">勾选</span>
                                </button>
                                <button class="calendar-action-btn" id="browsingCalendarLocateTodayBtn">
                                    <i class="fas fa-crosshairs"></i>
                                    <span class="btn-tooltip" id="browsingCalendarLocateTodayText">定位至今天</span>
                                </button>
                            </div>
                        </div>

                        <!-- 日历容器 -->
                        <div id="browsingCalendarView" class="bookmark-calendar-view">
                            <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                                <i class="fas fa-calendar-alt" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
                                <p id="browsingCalendarLoadingText">正在加载日历...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 子视图 2.2：点击排行 -->
                    <div id="browsingRankingPanel" class="browsing-sub-panel">
                        <div class="browsing-ranking-header">
                            <div class="browsing-ranking-title-block">
                                <div id="browsingRankingTitle" class="ranking-title">点击排行</div>
                                <div id="browsingRankingDescription" class="ranking-description">
                                    基于浏览器历史记录，按点击次数统计当前书签的热门程度。
                                </div>
                            </div>
                            <div class="browsing-ranking-filters">
                                <button id="browsingRankingFilterDay" class="ranking-time-filter-btn" data-range="day">当天</button>
                                <button id="browsingRankingFilterWeek" class="ranking-time-filter-btn" data-range="week">当周</button>
                                <button id="browsingRankingFilterMonth" class="ranking-time-filter-btn active" data-range="month">当月</button>
                                <button id="browsingRankingFilterYear" class="ranking-time-filter-btn" data-range="year">当年</button>
                            </div>
                        </div>
                        <div id="browsingRankingList" class="ranking-list">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="fas fa-chart-bar"></i></div>
                                <div class="empty-state-title" id="browsingRankingLoadingText">正在读取历史记录...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 子视图 2.3：书签关联记录 -->
                    <div id="browsingRelatedPanel" class="browsing-sub-panel">
                        <div class="browsing-ranking-header">
                            <div class="browsing-ranking-title-block">
                                <div id="browsingRelatedTitle" class="ranking-title">书签关联记录</div>
                                <div id="browsingRelatedDescription" class="ranking-description">
                                    显示浏览器历史记录，并用绿色边框凸显书签相关的记录。
                                </div>
                            </div>
                            <div class="browsing-ranking-filters">
                                <button id="browsingRelatedFilterDay" class="ranking-time-filter-btn active" data-range="day">当天</button>
                                <button id="browsingRelatedFilterWeek" class="ranking-time-filter-btn" data-range="week">当周</button>
                                <button id="browsingRelatedFilterMonth" class="ranking-time-filter-btn" data-range="month">当月</button>
                                <button id="browsingRelatedFilterYear" class="ranking-time-filter-btn" data-range="year">当年</button>
                                <button id="browsingRelatedSortBtn" class="ranking-sort-btn">
                                    <i class="fas fa-sort-amount-down"></i>
                                </button>
                            </div>
                        </div>
                        <!-- 时间段菜单容器（在筛选按钮下方） -->
                        <div id="browsingRelatedTimeMenu" class="browsing-time-menu" style="display: none;"></div>
                        <div id="browsingRelatedList" class="related-history-list">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="fas fa-history"></i></div>
                                <div class="empty-state-title" id="browsingRelatedLoadingText">正在读取历史记录...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 子视图 3：Anki 记忆曲线（占位） -->
                <div id="additionsAnkiPanel" class="additions-subview">
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="fas fa-brain"></i></div>
                        <div id="additionsAnkiTitle" class="empty-state-title">书签Anki（规划中）</div>
                        <div id="additionsAnkiDescription" class="empty-state-description">
                            未来会在这里加入基于 Anki 的复习节奏，帮助你按记忆曲线重新回顾书签。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bookmark Canvas 视图 (原Bookmark Tree改造) -->
            <div id="canvasView" class="view">
                <div class="view-header">
                    <div class="view-header-left">
                        <h2 id="canvasViewTitle">Bookmark Canvas</h2>
                    </div>
                    <div class="view-header-right">
                        <button id="importCanvasBtn" class="view-action-btn">
                            <i class="fas fa-file-import"></i>
                            <span id="importCanvasText">导入</span>
                        </button>
                        <button id="exportCanvasBtn" class="view-action-btn">
                            <i class="fas fa-file-export"></i>
                            <span id="exportCanvasText">导出</span>
                        </button>
                        <button id="clearTempNodesBtn" class="view-action-btn">
                            <i class="fas fa-trash-alt"></i>
                            <span id="clearTempNodesText">清空临时节点</span>
                        </button>
                    </div>
                </div>
                
                <!-- Canvas主容器 -->
                <div class="canvas-main-container" style="--canvas-scale: 1; --canvas-pan-x: 0px; --canvas-pan-y: 0px;">
                    <!-- 自定义纵向滚动条 -->
                    <div class="canvas-scrollbar vertical" id="canvasVerticalScrollbar">
                        <div class="scrollbar-controls">
                            <button class="scrollbar-btn scroll-hide" data-axis="vertical" data-action="toggle-hide" aria-label="隐藏纵向滚动条">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                            <button class="scrollbar-btn scroll-disable" data-axis="vertical" data-action="toggle-disable" aria-label="禁用纵向滚动">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                        <div class="scrollbar-track">
                            <div class="scrollbar-thumb" data-axis="vertical"></div>
                        </div>
                    </div>
                    
                    <!-- 自定义横向滚动条 -->
                    <div class="canvas-scrollbar horizontal" id="canvasHorizontalScrollbar" style="display: flex; align-items: center; gap: 12px;">
                        <div class="scrollbar-controls">
                            <button class="scrollbar-btn scroll-hide" data-axis="horizontal" data-action="toggle-hide" aria-label="隐藏横向滚动条">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                            <button class="scrollbar-btn scroll-disable" data-axis="horizontal" data-action="toggle-disable" aria-label="禁用横向滚动">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                        <span class="scrollbar-hint" data-i18n-text="horizontalScrollHint" data-en="Shift + Wheel" data-zh="Shift + 滚轮">Shift + 滚轮</span>
                        <div class="scrollbar-track">
                            <div class="scrollbar-thumb" data-axis="horizontal"></div>
                        </div>
                    </div>
                    
                    <!-- Canvas画布工作区 -->
                    <div class="canvas-workspace" id="canvasWorkspace">
                        <!-- 缩放控制器（固定在画布左上角） -->
                        <div class="canvas-zoom-indicator" id="canvasZoomIndicator" style="display: none;">
                            <div class="canvas-zoom-header">
                                <button class="canvas-fullscreen-btn" id="canvasFullscreenBtn" aria-label="进入全屏" aria-pressed="false">全屏</button>
                                <span class="canvas-zoom-label" id="canvasZoomLabel">缩放</span>
                                <span class="zoom-value" id="zoomValue">100%</span>
                            </div>
                            <div class="canvas-zoom-controls">
                                <button class="zoom-btn" id="zoomLocateBtn" title="定位到永久栏目"><span id="zoomLocateText">定位</span></button>
                                <button class="zoom-btn" id="zoomOutBtn" title="缩小 (10%)">−</button>
                                <button class="zoom-btn" id="zoomInBtn" title="放大 (10%)">+</button>
                            </div>
                            <div style="font-size: 10px; margin-top: 6px; color: #57606a; text-align: center;" id="canvasZoomHint">
                                <kbd style="font-size: 9px; padding: 2px 4px; background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 3px;">Ctrl</kbd> + 滚轮 | 
                                <kbd style="font-size: 9px; padding: 2px 4px; background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 3px;">空格</kbd> 拖动
                            </div>
                        </div>
                        
                        <!-- Canvas内容容器（应用缩放和平移） -->
                        <div class="canvas-content" id="canvasContent">
                            <!-- 临时节点和永久栏目都在这里 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 永久栏目 - 在canvas-content内部通过JS添加 -->
            <template id="permanentSectionTemplate">
                <div class="permanent-bookmark-section" id="permanentSection">
                    <div class="permanent-section-header" id="permanentSectionHeader">
                        <div class="permanent-section-title">
                            <h3 id="permanentSectionTitle">书签树 (永久栏目)</h3>
                            <div class="permanent-section-actions">
                                <button class="permanent-section-action-btn permanent-section-pin-btn pinned" id="permanentSectionPinBtn" title="置顶栏目">
                                    <i class="fas fa-thumbtack"></i>
                                </button>
                            </div>
                        </div>
                        <div class="permanent-section-tip-container" id="permanentSectionTipContainer">
                            <div class="permanent-section-tip-content">
                                <p class="permanent-section-tip" id="permanentSectionTip">拖动书签/文件夹至空白处，创建书签型临时节点；临时节点的修改不计入核心数据，可用来对比查看/整理；栏目间可互相拖动/粘贴</p>
                                <div class="permanent-section-tip-controls">
                                    <button class="permanent-section-tip-edit-btn" id="permanentSectionTipEditBtn" title="编辑说明">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="permanent-section-tip-close" id="permanentSectionTipClose" title="关闭提示">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <textarea class="permanent-section-tip-editor" id="permanentSectionTipEditor" style="display: none;" placeholder=""></textarea>
                        </div>
                    </div>
                    <div class="permanent-section-body">
                        <div id="bookmarkTree" class="bookmark-tree">
                            <!-- 动态加载书签树 -->
                        </div>
                    </div>
                </div>
            </template>
        </main>
    </div>

    <!-- 撤销覆盖层 -->
    <div id="revertOverlay" class="revert-overlay" style="display: none;">
        <div class="revert-overlay-content">
            <div class="revert-spinner"></div>
            <div class="revert-text" id="revertOverlayText">正在处理中...</div>
        </div>
    </div>

    <!-- 导出配置弹窗 (书签添加记录) -->
    <div id="exportModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="exportModalTitle">导出书签记录</h3>
                <button class="modal-close" id="closeExportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出范围</h4>
                    <p id="exportScopeText" style="font-weight: 500; font-size: 15px;">当前视图</p>
                </div>
                
                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出模式</h4>
                    <div class="radio-group" style="display: flex; flex-direction: column; gap: 8px;">
                        <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="exportMode" value="records" checked>
                            <span>仅导出添加记录 <small style="color: var(--text-tertiary);">(仅现有记录)</small></span>
                        </label>
                        <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="exportMode" value="context">
                            <span>现记录关联导出 <small style="color: var(--text-tertiary);">(包含同文件夹下的其他书签)</small></span>
                        </label>
                        <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="exportMode" value="collection">
                            <span>集合导出到日期文件夹 <small style="color: var(--text-tertiary);">(按日期归档，不保留原目录名)</small></span>
                        </label>
                    </div>
                </div>

                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出格式</h4>
                    <div class="checkbox-group" style="display: flex; flex-direction: column; gap: 8px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="exportFormat" value="html" checked>
                            <span>HTML (浏览器可导入)</span>
                        </label>
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="exportFormat" value="json">
                            <span>JSON</span>
                        </label>
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="exportFormat" value="copy">
                            <span>复制到剪贴板</span>
                        </label>
                    </div>
                </div>
                
                <div class="export-actions" style="text-align: right; border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <button id="doExportBtn" class="view-action-btn" style="display: inline-flex; width: auto;">
                        <i class="fas fa-file-export"></i> 开始导出
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导出配置弹窗 (点击记录) -->
    <div id="browsingExportModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="browsingExportModalTitle">导出点击记录</h3>
                <button class="modal-close" id="closeBrowsingExportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出范围</h4>
                    <p id="browsingExportScopeText" style="font-weight: 500; font-size: 15px;">当前视图</p>
                </div>
                
                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出模式</h4>
                    <div class="radio-group" style="display: flex; flex-direction: column; gap: 8px;">
                        <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="browsingExportMode" value="records" checked>
                            <span>仅导出点击记录 <small style="color: var(--text-tertiary);">(仅现有记录)</small></span>
                        </label>
                        <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="browsingExportMode" value="collection">
                            <span>集合导出到日期文件夹 <small style="color: var(--text-tertiary);">(按日期归档，不保留原目录名)</small></span>
                        </label>
                    </div>
                </div>

                <div class="export-section" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">导出格式</h4>
                    <div class="checkbox-group" style="display: flex; flex-direction: column; gap: 8px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="browsingExportFormat" value="html" checked>
                            <span>HTML (浏览器可导入)</span>
                        </label>
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="browsingExportFormat" value="json">
                            <span>JSON</span>
                        </label>
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" name="browsingExportFormat" value="copy">
                            <span>复制到剪贴板</span>
                        </label>
                    </div>
                </div>
                
                <div class="export-actions" style="text-align: right; border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <button id="doBrowsingExportBtn" class="view-action-btn" style="display: inline-flex; width: auto;">
                        <i class="fas fa-file-export"></i> 开始导出
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 详情弹窗 -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">变化详情</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 动态加载详情内容 -->
            </div>
        </div>
    </div>
</body>
</html>
